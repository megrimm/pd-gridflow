#N canvas 344 30 680 557 10;
#X text 287 159 disable falling;
#X obj 2 96 fork;
#X obj 273 294 # != 0;
#X obj 334 332 #fold +;
#X obj 8 414 s position;
#X obj 192 29 tgl 15 0 empty empty empty 0 -6 0 8 -24198 -1 -1 1 1
;
#X obj 273 351 #export;
#X obj 192 82 #store;
#X obj 217 113 shunt 2;
#N canvas 25 226 369 359 mouse 0;
#X text 143 214 is there a click?;
#X obj 44 114 != 0;
#X text 112 256 coordinates;
#X obj 19 8 inlet;
#X text 56 9 #out's outlet 0;
#X obj 44 93 >> 8;
#X obj 65 237 listsublist 0 2;
#X obj 16 31 route position;
#X obj 94 214 outlet;
#X obj 65 257 outlet;
#X obj 16 214 shunt 2;
#X obj 44 72 listelement 2;
#X obj 16 51 t a a;
#X connect 1 0 8 0;
#X connect 1 0 10 1;
#X connect 3 0 7 0;
#X connect 5 0 1 0;
#X connect 6 0 9 0;
#X connect 7 0 12 0;
#X connect 10 1 6 0;
#X connect 11 0 5 0;
#X connect 12 0 10 0;
#X connect 12 1 11 0;
#X restore 366 132 pd mouse click/drag;
#X obj 327 132 # / 2;
#X obj 273 313 #ravel;
#X msg 8 76 100 100;
#X obj 217 158 shunt 2;
#X obj 34 96 s size;
#X obj 273 332 #fold +;
#X obj 420 95 tgl 15 0 empty empty empty 0 -6 0 8 -241291 -1 -1 0 1
;
#X obj 334 294 @! abs;
#X obj 402 338 #export;
#X obj 402 300 #ravel;
#X obj 256 220 shunt 2;
#X obj 271 159 tgl 15 0 empty empty empty 0 -6 0 8 -241291 -1 -1 0
1;
#X obj 334 351 #export;
#X obj 367 94 shunt 2;
#X obj 2 230 #greyscale_to_rgb;
#X obj 367 113 r position;
#N canvas 436 233 496 430 falling 1;
#X obj 42 237 # +;
#X text 228 336 vertical falling;
#X obj 98 25 inlet;
#X text 139 25 Dim[rows \, columns \, {height}];
#X obj 43 331 #store;
#X obj 43 310 #finished;
#X obj 42 258 # +;
#X obj 43 356 # +;
#X text 96 397 Dim[rows \, columns \, {height}];
#X text 216 219 horizontal falling;
#X obj 43 377 # +;
#X obj 42 103 #store;
#X obj 43 396 outlet;
#X obj 42 84 #finished;
#X obj 81 286 t a a;
#X obj 111 356 #convolve (2 1 # 1 1) \, fold inv+;
#X obj 111 377 #convolve (3 1 # 1 1 0) \, fold inv+;
#X obj 70 356 # / 4;
#X obj 70 377 # / 4;
#X obj 69 237 # / 4;
#X obj 69 258 # / 4;
#X obj 108 237 #convolve (1 2 # 1 1) \, fold inv+;
#X obj 109 258 #convolve (1 3 # 1 1 0) \, fold inv+;
#X obj 153 119 # rand;
#X obj 137 190 # +;
#X obj 153 138 # - 15;
#X obj 153 100 # put 45;
#X obj 153 163 # / 14;
#X obj 96 59 t a a a;
#X connect 0 0 6 0;
#X connect 2 0 28 0;
#X connect 4 0 7 0;
#X connect 5 0 4 0;
#X connect 6 0 14 0;
#X connect 7 0 10 0;
#X connect 10 0 12 0;
#X connect 11 0 0 0;
#X connect 13 0 11 0;
#X connect 14 0 5 0;
#X connect 14 1 4 1;
#X connect 14 1 15 0;
#X connect 14 1 16 0;
#X connect 15 0 17 0;
#X connect 16 0 18 0;
#X connect 17 0 7 1;
#X connect 18 0 10 1;
#X connect 19 0 0 1;
#X connect 20 0 6 1;
#X connect 21 0 19 0;
#X connect 22 0 20 0;
#X connect 23 0 25 0;
#X connect 24 0 21 0;
#X connect 24 0 22 0;
#X connect 25 0 27 0;
#X connect 26 0 23 0;
#X connect 27 0 24 1;
#X connect 28 0 13 0;
#X connect 28 1 11 1;
#X connect 28 1 21 0;
#X connect 28 1 22 0;
#X restore 217 178 pd falling sand;
#X obj 2 373 #scale_by 2;
#X obj 2 170 shunt 3;
#X obj 2 452 print;
#X obj 197 65 bng 15 250 50 0 empty empty empty 0 -6 0 8 -24198 -1
-1;
#X text 253 46 auto;
#N canvas 525 58 536 584 finger 0;
#X obj 192 7 inlet;
#X obj 36 78 bng 15 250 50 0 empty empty empty 0 -6 0 8 -262144 -1
-1;
#X obj 63 267 # / 20;
#X obj 74 327 # *;
#X obj 12 436 #store;
#X obj 14 18 inlet;
#X obj 73 309 #redim ( 64 64 1 );
#X obj 279 51 loadbang;
#X obj 13 38 fork;
#X obj 63 247 #fold +;
#X text 22 159 "dig" the sphere into the sand;
#X text 240 104 compute a halfsphere;
#X obj 192 29 # - 32;
#X obj 63 225 #ravel;
#N canvas 1 58 415 284 make 0;
#X obj 28 129 #fold +;
#X obj 28 66 # -;
#X obj 28 108 @! sq;
#X obj 28 45 #for ( -32 -32 ) ( 32 32 ) ( 1 1 );
#X obj 28 171 outlet;
#X obj 28 87 # << 2;
#X obj 28 150 @! sqrt;
#X text 63 21 bang;
#X obj 27 20 inlet;
#X text 98 92 make distance map;
#X connect 0 0 6 0;
#X connect 1 0 5 0;
#X connect 2 0 0 0;
#X connect 3 0 1 0;
#X connect 5 0 2 0;
#X connect 6 0 4 0;
#X connect 8 0 3 0;
#X restore 259 74 pd make distance map with center 32;
#X obj 12 480 outlet;
#X obj 260 53 bng 15 250 50 0 empty empty empty 0 -6 0 8 -262144 -1
-1;
#X text 83 293 find out how high the compensation torus should be;
#X obj 73 349 # div 256;
#X obj 36 58 route grid;
#X obj 12 417 #finished;
#X obj 13 206 t a a;
#N canvas 669 471 315 202 halfsphere 0;
#X obj 45 19 inlet distancemap;
#X obj 45 143 outlet image;
#X obj 46 102 @! sqrt;
#X obj 46 122 #outer ignore ( 0 );
#X obj 46 62 # inv+ 200;
#X text 121 63 16 * radius^2;
#X obj 46 41 @! sq;
#X obj 46 82 # max 0;
#X connect 0 0 6 0;
#X connect 2 0 3 0;
#X connect 3 0 1 0;
#X connect 4 0 7 0;
#X connect 6 0 4 0;
#X connect 7 0 2 0;
#X restore 126 120 pd halfsphere;
#X obj 13 141 #draw_image - ( 1 1 1 # ) ( 0 0 );
#X obj 12 457 #draw_image - ( 1 1 1 # ) ( 0 0 );
#N canvas 0 0 323 279 torus 0;
#X obj 59 26 inlet;
#X obj 56 185 outlet;
#X obj 57 97 # inv+ 200;
#X obj 57 76 @! sq;
#X text 102 54 toroidal radius;
#X obj 57 162 #outer ignore ( 0 );
#X obj 56 120 # max 0;
#X text 138 99 16*radius^2;
#X obj 57 141 @! sqrt;
#X obj 57 56 # - 20;
#X connect 0 0 9 0;
#X connect 2 0 6 0;
#X connect 3 0 2 0;
#X connect 5 0 1 0;
#X connect 6 0 8 0;
#X connect 8 0 5 0;
#X connect 9 0 3 0;
#X restore 296 346 pd torus;
#X text 65 475 put extra sand as a ring around the hole;
#X connect 0 0 12 0;
#X connect 1 0 16 0;
#X connect 2 0 6 0;
#X connect 3 0 18 0;
#X connect 4 0 24 0;
#X connect 5 0 8 0;
#X connect 6 0 3 0;
#X connect 7 0 14 0;
#X connect 8 0 23 0;
#X connect 8 1 19 0;
#X connect 9 0 2 0;
#X connect 12 0 23 2;
#X connect 12 0 24 2;
#X connect 13 0 9 0;
#X connect 14 0 22 0;
#X connect 14 0 25 0;
#X connect 16 0 14 0;
#X connect 18 0 24 1;
#X connect 19 0 1 0;
#X connect 20 0 4 0;
#X connect 21 0 20 0;
#X connect 21 1 13 0;
#X connect 21 1 4 1;
#X connect 22 0 23 1;
#X connect 23 0 21 0;
#X connect 24 0 15 0;
#X connect 25 0 3 1;
#X restore 260 132 pd finger;
#X obj 310 266 # -;
#X obj 334 313 #ravel;
#X msg 2 56 240 320;
#X obj 402 319 #fold +;
#X obj 2 211 # + 128;
#X obj 55 344 #greyscale_to_rgb;
#X obj 270 115 tgl 15 0 empty empty empty 0 -6 0 8 -241291 -1 -1 0
1;
#X text 325 220 enable stats;
#X text 239 391 checking for conservation of amounts of sand;
#X msg 2 115 \$1 \$2 1 # 0;
#N canvas 441 73 441 441 lighting 0;
#X obj 27 256 outlet;
#X obj 27 178 # +;
#X obj 17 9 inlet;
#X obj 103 39 r size;
#X obj 27 39 #redim ( );
#X obj 27 84 #finished;
#X obj 27 111 #store;
#X obj 27 59 t a a;
#X text 163 57 colourize the horizontal differences;
#X text 123 123 colourize the vertical differences;
#X obj 100 94 #outer & (-1 0 0);
#X obj 109 161 #outer & (0 -1 0);
#X obj 109 141 #convolve (4 1 # 1 -8 8 -1);
#X obj 100 74 #convolve (1 4 # 1 -8 8 -1);
#X obj 27 199 # << 2;
#X obj 27 237 #clip;
#X obj 27 218 # + (220 200 180);
#X connect 1 0 14 0;
#X connect 2 0 4 0;
#X connect 3 0 4 1;
#X connect 4 0 7 0;
#X connect 5 0 6 0;
#X connect 6 0 1 0;
#X connect 7 0 5 0;
#X connect 7 1 12 0;
#X connect 7 1 13 0;
#X connect 10 0 6 1;
#X connect 11 0 1 1;
#X connect 12 0 11 0;
#X connect 13 0 10 0;
#X connect 14 0 16 0;
#X connect 15 0 0 0;
#X connect 16 0 15 0;
#X restore 26 268 pd lighting;
#X obj 2 433 fps detailed;
#X obj 309 221 tgl 15 0 empty empty empty 0 -6 0 8 -241291 -1 -1 0
1;
#X text 213 65 step;
#X obj 68 182 vradio 15 1 0 3 empty empty empty 0 -6 0 8 -241291 -1
-1 1;
#X obj 2 394 #out window;
#X obj 273 372 nbx 5 14 -1e+37 1e+37 0 0 empty empty empty 0 -6 0 10
-262144 -1 -1 0 256;
#X obj 334 372 nbx 5 14 -1e+37 1e+37 0 0 empty empty empty 0 -6 0 10
-262144 -1 -1 0 256;
#X obj 402 357 nbx 8 14 -1e+37 1e+37 0 0 empty empty empty 0 -6 0 10
-262144 -1 -1 0 256;
#X text 87 196 differential;
#X text 86 181 heightmap;
#X text 86 212 topographic;
#X obj 152 82 t a a;
#X obj 217 220 t a a;
#X obj 56 325 # * 255;
#X obj 56 306 # >= 6;
#X obj 56 287 # & 7;
#X obj 2 37 loadbang;
#X text 436 95 disable finger;
#X obj 300 244 t a a;
#X obj 2 192 # << 2;
#X obj 192 46 metro 20;
#X obj -15 499 cnv 15 680 30 empty empty empty 20 12 0 14 -200249 -66577
0;
#X text -7 506 GridFlow 0.8.0;
#X text -7 506 GridFlow 0.8.0;
#X obj -13 -25 cnv 15 680 30 empty empty empty 20 12 0 14 -233017 -66577
0;
#X text 0 -12 Copyright 2002 Mathieu Bouchard;
#X text 0 -25 sand.pd;
#X text -1 21 set size & reset;
#X obj 2 295 #clip;
#X obj 26 249 # << 0;
#X obj 68 144 loadbang;
#X msg 68 163 1;
#N canvas 292 75 480 513 falling 0;
#X text 292 85 horizontal falling;
#X obj 42 110 #store;
#X obj 73 58 fork;
#X obj 101 240 fork;
#X obj 46 392 outlet;
#X obj 42 147 # +;
#X obj 46 307 # +;
#X obj 46 288 #store;
#X obj 42 91 #finished;
#X obj 42 166 # +;
#X obj 46 269 #finished;
#X text 88 17 Dim[rows \, columns \, {height}];
#X text 293 262 vertical falling;
#X obj 46 326 # +;
#X text 101 392 Dim[rows \, columns \, {height}];
#X obj 47 17 inlet;
#X obj 162 149 #convolve (1 2 # 1 1) \, fold inv+ \, seed -3;
#X obj 162 168 #convolve (1 3 # 1 1 0) \, fold inv+ \, seed -3;
#X obj 170 305 #convolve (2 1 # 1 1) \, fold inv+ \, seed -3;
#X obj 170 324 #convolve (3 1 # 1 1 0) \, fold inv+ \, seed -3;
#X obj 123 149 # / 5;
#X obj 123 168 # / 5;
#X obj 131 305 # / 5;
#X obj 131 324 # / 5;
#X connect 1 0 5 0;
#X connect 2 0 8 0;
#X connect 2 1 1 1;
#X connect 2 1 16 0;
#X connect 2 1 17 0;
#X connect 3 0 10 0;
#X connect 3 1 7 1;
#X connect 3 1 18 0;
#X connect 3 1 19 0;
#X connect 5 0 9 0;
#X connect 6 0 13 0;
#X connect 7 0 6 0;
#X connect 8 0 1 0;
#X connect 9 0 3 0;
#X connect 10 0 7 0;
#X connect 13 0 4 0;
#X connect 15 0 2 0;
#X connect 16 0 20 0;
#X connect 17 0 21 0;
#X connect 18 0 22 0;
#X connect 19 0 23 0;
#X connect 20 0 5 1;
#X connect 21 0 9 1;
#X connect 22 0 6 1;
#X connect 23 0 13 1;
#X restore 262 198 pd falling sand (2);
#X connect 1 0 42 0;
#X connect 1 1 14 0;
#X connect 2 0 11 0;
#X connect 3 0 22 0;
#X connect 5 0 64 0;
#X connect 6 0 49 0;
#X connect 7 0 8 0;
#X connect 8 0 13 0;
#X connect 8 1 32 0;
#X connect 9 0 10 0;
#X connect 9 1 23 0;
#X connect 10 0 32 1;
#X connect 11 0 15 0;
#X connect 12 0 1 0;
#X connect 13 0 26 0;
#X connect 13 1 56 0;
#X connect 15 0 6 0;
#X connect 16 0 23 1;
#X connect 17 0 34 0;
#X connect 18 0 51 0;
#X connect 19 0 36 0;
#X connect 20 1 19 0;
#X connect 20 1 62 0;
#X connect 21 0 13 1;
#X connect 22 0 50 0;
#X connect 23 0 8 1;
#X connect 24 0 72 0;
#X connect 25 0 9 0;
#X connect 26 0 56 0;
#X connect 27 0 48 0;
#X connect 28 0 63 0;
#X connect 28 1 73 0;
#X connect 28 2 59 0;
#X connect 30 0 7 0;
#X connect 32 0 13 0;
#X connect 33 0 17 0;
#X connect 33 0 2 0;
#X connect 34 0 3 0;
#X connect 35 0 1 0;
#X connect 36 0 18 0;
#X connect 37 0 24 0;
#X connect 38 0 27 0;
#X connect 39 0 8 1;
#X connect 42 0 55 0;
#X connect 43 0 72 0;
#X connect 44 0 29 0;
#X connect 45 0 20 1;
#X connect 47 0 28 1;
#X connect 48 0 44 0;
#X connect 48 0 4 0;
#X connect 55 0 28 0;
#X connect 55 1 7 1;
#X connect 56 0 55 0;
#X connect 56 1 20 0;
#X connect 57 0 38 0;
#X connect 58 0 57 0;
#X connect 59 0 58 0;
#X connect 60 0 35 0;
#X connect 62 0 33 1;
#X connect 62 1 33 0;
#X connect 63 0 37 0;
#X connect 64 0 7 0;
#X connect 72 0 27 0;
#X connect 73 0 43 0;
#X connect 74 0 75 0;
#X connect 75 0 47 0;
#X connect 76 0 56 0;
