#!/usr/bin/env ruby
if ARGV.length != 1
  puts "usage: core.rb <corefile>"
  exit 1
end
qfile=ARGV[0].gsub /'/, "\\\\'"
x=`gdb --batch -c '#{qfile}'`.split"\n"
m=/`([^ ]+)/.match x[0]
puts m[1]
cmd="gdb #{m[1]} #{qfile} --command=bt"
puts cmd
x=`#{cmd}`
p x
