#N canvas 567 83 680 557 10;
#X text 269 158 disable falling;
#X obj 2 96 t a a;
#X obj 344 351 #fold +;
#X obj 8 372 s position;
#X obj 192 29 tgl 15 0 empty empty empty 0 -6 0 8 -24198 -1 -1 1 1
;
#X obj 283 370 #to_float;
#X obj 192 82 #store;
#X obj 295 113 # / 2;
#X obj 283 332 #ravel;
#X obj 34 96 s size;
#X obj 283 351 #fold +;
#X obj 392 307 #to_float;
#X obj 392 269 #ravel;
#X obj 253 159 tgl 15 0 empty empty empty 0 -6 0 8 -241291 -1 -1 0
1;
#X obj 344 370 #to_float;
#X obj 2 230 #greyscale_to_rgb;
#X obj 295 65 r position;
#N canvas 670 149 496 344 falling 0;
#X obj 42 147 # +;
#X text 227 189 vertical falling;
#X obj 42 40 inlet;
#X obj 42 168 # +;
#X obj 42 209 # +;
#X text 216 129 horizontal falling;
#X obj 42 230 # +;
#X obj 42 249 outlet;
#X obj 110 209 #convolve (2 1 # 1 1) \, fold inv+;
#X obj 110 230 #convolve (3 1 # 1 1 0) \, fold inv+;
#X obj 69 209 # / 4;
#X obj 69 230 # / 4;
#X obj 69 147 # / 4;
#X obj 69 168 # / 4;
#X obj 108 147 #convolve (1 2 # 1 1) \, fold inv+;
#X obj 109 168 #convolve (1 3 # 1 1 0) \, fold inv+;
#X obj 123 116 # +;
#X obj 159 97 # - 32;
#X obj 159 116 # div 50;
#X obj 159 78 # rand;
#X msg 170 55 3072 # 128;
#X text 237 55 bug;
#X obj 42 84 #t;
#X obj 42 59 t a b;
#X obj 159 32 #store (1111 # 128);
#X connect 0 0 3 0;
#X connect 2 0 23 0;
#X connect 3 0 4 0;
#X connect 4 0 6 0;
#X connect 6 0 7 0;
#X connect 8 0 10 0;
#X connect 9 0 11 0;
#X connect 10 0 4 1;
#X connect 11 0 6 1;
#X connect 12 0 0 1;
#X connect 13 0 3 1;
#X connect 14 0 12 0;
#X connect 15 0 13 0;
#X connect 16 0 14 0;
#X connect 16 0 15 0;
#X connect 16 0 8 0;
#X connect 16 0 9 0;
#X connect 17 0 18 0;
#X connect 18 0 16 1;
#X connect 19 0 17 0;
#X connect 20 0 19 0;
#X connect 22 0 0 0;
#X connect 22 1 16 0;
#X connect 23 0 22 0;
#X connect 23 1 24 0;
#X connect 24 0 19 0;
#X restore 217 177 pd falling sand;
#X obj 2 170 shunt 3;
#X obj 2 410 print;
#X obj 197 65 bng 15 250 50 0 empty empty empty 0 -6 0 8 -24198 -1
-1;
#X text 210 27 auto;
#N canvas 301 45 536 447 finger 0;
#X obj 192 7 inlet;
#X obj 112 244 # / 20;
#X obj 112 297 # *;
#X obj 13 244 #store;
#X obj 14 18 inlet;
#X obj 279 51 loadbang;
#X obj 13 38 t a a;
#X obj 112 225 #fold +;
#X text 22 159 "dig" the sphere into the sand;
#X text 240 104 compute a halfsphere;
#X obj 192 26 # - 32;
#X obj 112 206 #ravel;
#X obj 13 420 outlet;
#X obj 260 53 bng 15 250 50 0 empty empty empty 0 -6 0 8 -262144 -1
-1;
#X text 117 260 find out how high the compensation torus should be
;
#X obj 112 316 # div 256;
#X obj 36 58 route grid;
#X obj 13 225 #finished;
#X obj 13 206 t a a;
#N canvas 669 471 332 190 halfsphere 0;
#X obj 45 19 inlet distancemap;
#X obj 45 133 outlet image;
#X obj 45 57 # inv+ 200;
#X text 120 58 16 * radius^2;
#X obj 45 76 # max 0;
#X obj 45 38 # sq-;
#X obj 45 95 # sqrt;
#X obj 45 114 #outer ignore (0);
#X connect 0 0 5 0;
#X connect 2 0 4 0;
#X connect 4 0 6 0;
#X connect 5 0 2 0;
#X connect 6 0 7 0;
#X connect 7 0 1 0;
#X restore 98 122 pd halfsphere;
#N canvas 0 0 287 192 torus 1;
#X obj 59 26 inlet;
#X obj 59 140 outlet;
#X obj 59 64 # inv+ 200;
#X text 112 45 toroidal radius;
#X text 140 66 16*radius^2;
#X obj 59 45 # sq- 20;
#X obj 59 83 # max;
#X obj 59 102 # sqrt;
#X obj 59 121 #outer ignore (0);
#X connect 0 0 5 0;
#X connect 2 0 6 0;
#X connect 5 0 2 0;
#X connect 6 0 7 0;
#X connect 7 0 8 0;
#X connect 8 0 1 0;
#X restore 259 280 pd torus;
#X text 66 415 put extra sand as a ring around the hole;
#X obj 112 278 #redim (64 64 1);
#X obj 13 397 #draw_image - (1 1 1 #) (0 0);
#X obj 13 141 #draw_image - (1 1 1 #) (0 0);
#X obj 13 343 shunt 2;
#X obj 64 343 tgl 15 0 empty empty empty 0 -6 0 8 -241291 -1 -1 0 1
;
#X obj 36 77 b;
#N canvas 265 109 415 174 distance_map_with_centre_32 0;
#X obj 27 77 #fold +;
#X obj 27 115 outlet;
#X text 63 21 bang;
#X obj 27 20 inlet;
#X text 97 63 make distance map;
#X obj 27 58 # sq-;
#X obj 27 39 #for (-128 -128) (128 128) (4 4);
#X obj 27 96 # sqrt;
#X connect 0 0 7 0;
#X connect 3 0 6 0;
#X connect 5 0 0 0;
#X connect 6 0 5 0;
#X connect 7 0 1 0;
#X restore 259 74 pd distance_map_with_centre_32;
#X connect 0 0 10 0;
#X connect 1 0 22 0;
#X connect 2 0 15 0;
#X connect 3 0 25 0;
#X connect 4 0 6 0;
#X connect 5 0 28 0;
#X connect 6 0 24 0;
#X connect 6 1 16 0;
#X connect 7 0 1 0;
#X connect 10 0 23 2;
#X connect 10 0 24 2;
#X connect 11 0 7 0;
#X connect 13 0 28 0;
#X connect 15 0 23 1;
#X connect 16 0 27 0;
#X connect 17 0 3 0;
#X connect 18 0 17 0;
#X connect 18 1 11 0;
#X connect 18 1 3 1;
#X connect 19 0 24 1;
#X connect 20 0 2 1;
#X connect 22 0 2 0;
#X connect 23 0 12 0;
#X connect 24 0 18 0;
#X connect 25 0 23 0;
#X connect 25 1 12 0;
#X connect 26 0 25 1;
#X connect 27 0 28 0;
#X connect 28 0 19 0;
#X connect 28 0 20 0;
#X restore 244 132 pd finger;
#X obj 305 286 # -;
#X obj 344 332 #ravel;
#X msg 2 56 240 320;
#X obj 392 288 #fold +;
#X obj 2 211 # + 128;
#X text 324 219 enable stats;
#X text 249 410 checking for conservation of amounts of sand;
#X msg 2 115 \$1 \$2 1 # 0;
#N canvas 657 125 462 297 lighting 0;
#X obj 27 234 outlet;
#X obj 27 18 inlet;
#X obj 27 177 # << 2;
#X obj 27 215 #clip;
#X obj 27 196 # + (220 200 180);
#X obj 27 37 #t;
#X obj 27 56 #greyscale_to_rgb;
#X obj 59 104 #outer & (-1 0 0);
#X text 183 103 colourise the horizontal differences;
#X text 183 149 colourise the vertical differences;
#X obj 60 84 #convolve (1 4 # 1 8 8 1) \, fold inv+;
#X obj 27 149 # -;
#X obj 59 129 #convolve (4 1 # 1 8 8 1) \, fold inv+;
#X obj 27 104 # -;
#X obj 59 149 #outer & (0 -1 0);
#X connect 1 0 5 0;
#X connect 2 0 4 0;
#X connect 3 0 0 0;
#X connect 4 0 3 0;
#X connect 5 0 6 0;
#X connect 5 1 10 0;
#X connect 5 1 12 0;
#X connect 6 0 13 0;
#X connect 7 0 13 1;
#X connect 10 0 7 0;
#X connect 11 0 2 0;
#X connect 12 0 14 0;
#X connect 13 0 11 0;
#X connect 14 0 11 1;
#X restore 21 268 pd lighting;
#X obj 2 391 fps detailed;
#X obj 308 220 tgl 15 0 empty empty empty 0 -6 0 8 -241291 -1 -1 0
1;
#X text 214 63 step;
#X obj 67 183 vradio 15 1 0 3 empty empty empty 0 -6 0 8 -241291 -1
-1 1;
#X obj 2 352 #out window;
#X obj 283 391 nbx 5 14 -1e+37 1e+37 0 0 empty empty empty 0 -6 0 10
-262144 -1 -1 0 256;
#X obj 344 391 nbx 8 14 -1e+37 1e+37 0 0 empty empty empty 0 -6 0 10
-262144 -1 -1 0 256;
#X obj 392 326 nbx 8 14 -1e+37 1e+37 0 0 empty empty empty 0 -6 0 10
-262144 -1 -1 0 256;
#X text 87 196 differential;
#X text 86 181 heightmap;
#X text 86 212 topographic;
#X obj 152 82 t a a;
#X obj 217 202 t a a;
#X obj 2 37 loadbang;
#X obj 305 259 t a a;
#X obj 2 192 # << 2;
#X obj -15 499 cnv 15 680 30 empty empty empty 20 12 0 14 -200249 -66577
0;
#X text -7 506 GridFlow 0.8.0;
#X text -7 506 GridFlow 0.8.0;
#X obj -13 -25 cnv 15 680 30 empty empty empty 20 12 0 14 -233017 -66577
0;
#X text 0 -25 sand.pd;
#X text -1 21 set size & reset;
#X obj 2 249 #clip;
#X obj 68 144 loadbang;
#X msg 68 163 1;
#X msg 8 76 120 160;
#X obj 192 46 metro 33.3667;
#N canvas 0 0 450 300 topographic 0;
#X obj 35 18 inlet;
#X obj 35 170 #greyscale_to_rgb;
#X obj 35 37 #convolve (3 3 # 1 2 1 2 4 2);
#X obj 35 151 #clip;
#X obj 35 56 # & 127;
#X obj 35 189 outlet;
#X obj 35 75 # abs- 108;
#X obj 35 94 # min 20;
#X obj 35 113 # inv+ 20;
#X obj 35 132 # << 5;
#X connect 0 0 2 0;
#X connect 1 0 5 0;
#X connect 2 0 4 0;
#X connect 3 0 1 0;
#X connect 4 0 6 0;
#X connect 6 0 7 0;
#X connect 7 0 8 0;
#X connect 8 0 9 0;
#X connect 9 0 3 0;
#X restore 41 287 pd topographic;
#X text 0 -12 Copyright 2002 \, 2006 Mathieu Bouchard;
#X obj 344 313 # abs-;
#X obj 295 84 #mouse \, \, \, \, \,;
#X obj 217 113 shunt;
#X obj 217 158 shunt;
#X obj 266 219 spigot;
#X obj 283 313 # !=;
#X obj 2 330 #scale_by 2;
#X text 590 22 16.8 fps;
#X text 590 8 14.2 fps;
#X text 590 35 17.1 fps;
#X connect 1 0 30 0;
#X connect 1 1 9 0;
#X connect 2 0 14 0;
#X connect 4 0 58 0;
#X connect 5 0 37 0;
#X connect 6 0 63 0;
#X connect 7 0 22 1;
#X connect 8 0 10 0;
#X connect 10 0 5 0;
#X connect 11 0 39 0;
#X connect 12 0 26 0;
#X connect 13 0 64 1;
#X connect 14 0 38 0;
#X connect 15 0 54 0;
#X connect 16 0 62 0;
#X connect 17 0 44 0;
#X connect 18 0 47 0;
#X connect 18 1 31 0;
#X connect 18 2 59 0;
#X connect 20 0 6 0;
#X connect 22 0 64 0;
#X connect 23 0 61 0;
#X connect 23 0 66 0;
#X connect 24 0 2 0;
#X connect 25 0 1 0;
#X connect 26 0 11 0;
#X connect 27 0 15 0;
#X connect 30 0 43 0;
#X connect 31 0 67 0;
#X connect 32 0 19 0;
#X connect 33 0 65 1;
#X connect 35 0 18 1;
#X connect 36 0 32 0;
#X connect 36 0 3 0;
#X connect 43 0 18 0;
#X connect 43 1 6 1;
#X connect 44 0 43 0;
#X connect 44 1 65 0;
#X connect 45 0 25 0;
#X connect 46 0 23 1;
#X connect 46 1 23 0;
#X connect 47 0 27 0;
#X connect 54 0 67 0;
#X connect 55 0 56 0;
#X connect 56 0 35 0;
#X connect 57 0 1 0;
#X connect 58 0 6 0;
#X connect 59 0 67 0;
#X connect 61 0 24 0;
#X connect 62 0 7 0;
#X connect 62 1 7 0;
#X connect 62 4 63 1;
#X connect 63 0 64 0;
#X connect 63 1 22 0;
#X connect 64 0 17 0;
#X connect 64 1 44 0;
#X connect 65 0 46 0;
#X connect 65 0 12 0;
#X connect 66 0 8 0;
#X connect 67 0 36 0;
